FROM java:8-jre
MAINTAINER FIWARE Cepheus Team

ENV CEPHEUS_VERSION LATEST

# Install Supervisor
RUN apt-get update && apt-get install -y supervisor wget
RUN mkdir -p /var/log/supervisor
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

WORKDIR /opt/cepheus

# Download CEP and Light Broker
RUN wget -q -O cepheus-cep.jar "https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&g=com.orange.cepheus&a=cepheus-cep&v=$CEPHEUS_VERSION"
RUN wget -q -O cepheus-lb.jar "https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&g=com.orange.cepheus&a=cepheus-lb&v=$CEPHEUS_VERSION"

# Expose 8080 for CEP, 8081 for broker
EXPOSE 8080 8081

# Launch supervisor
ENTRYPOINT ["/usr/bin/supervisord"]
CMD []

